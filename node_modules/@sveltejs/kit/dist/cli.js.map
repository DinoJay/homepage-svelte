{"version":3,"file":"cli.js","sources":["../src/cli.js"],"sourcesContent":["import { existsSync } from 'fs';\nimport sade from 'sade';\nimport colors from 'kleur';\nimport { load_config } from './api/load_config';\nimport * as pkg from '../package.json';\n\nasync function get_config() {\n\ttry {\n\t\treturn await load_config();\n\t} catch (error) {\n\t\tlet message = error.message;\n\n\t\tif (error.code === 'MODULE_NOT_FOUND') {\n\t\t\tif (existsSync('svelte.config.js')) {\n\t\t\t\t// TODO this is temporary, for the benefit of early adopters\n\t\t\t\tmessage =\n\t\t\t\t\t'You must rename svelte.config.js to svelte.config.cjs, and snowpack.config.js to snowpack.config.cjs';\n\t\t\t} else {\n\t\t\t\tmessage = 'Missing svelte.config.cjs';\n\t\t\t}\n\t\t} else if (error.name === 'SyntaxError') {\n\t\t\tmessage = 'Malformed svelte.config.cjs';\n\t\t}\n\n\t\tconsole.error(colors.bold().red(message));\n\t\tconsole.error(colors.grey(error.stack));\n\t\tprocess.exit(1);\n\t}\n}\n\nfunction handle_error(error) {\n\tconsole.log(colors.bold().red(`> ${error.message}`));\n\tconsole.log(colors.gray(error.stack));\n\tprocess.exit(1);\n}\n\nasync function launch(port) {\n\tconst { exec } = await import('child_process');\n\texec(`${process.platform == 'win32' ? 'start' : 'open'} http://localhost:${port}`);\n}\n\nconst prog = sade('svelte').version(pkg.version);\n\nprog\n\t.command('dev')\n\t.describe('Start a development server')\n\t.option('-p, --port', 'Port', 3000)\n\t.option('-o, --open', 'Open a browser tab', false)\n\t.action(async ({ port, open }) => {\n\t\tprocess.env.NODE_ENV = 'development';\n\t\tconst config = await get_config();\n\n\t\tconst { dev } = await import('./api/dev');\n\n\t\ttry {\n\t\t\tconst watcher = await dev({ port, config });\n\n\t\t\twatcher.on('stdout', (data) => {\n\t\t\t\tprocess.stdout.write(data);\n\t\t\t});\n\n\t\t\twatcher.on('stderr', (data) => {\n\t\t\t\tprocess.stderr.write(data);\n\t\t\t});\n\n\t\t\tconsole.log(colors.bold().cyan(`> Listening on http://localhost:${watcher.port}`));\n\t\t\tif (open) launch(watcher.port);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('build')\n\t.describe('Create a production build of your app')\n\t.action(async () => {\n\t\tprocess.env.NODE_ENV = 'production';\n\t\tconst config = await get_config();\n\n\t\tconst { build } = await import('./api/build');\n\n\t\ttry {\n\t\t\tawait build(config);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('start')\n\t.describe('Serve an already-built app')\n\t.option('-p, --port', 'Port', 3000)\n\t.option('-o, --open', 'Open a browser tab', false)\n\t.action(async ({ port, open }) => {\n\t\tprocess.env.NODE_ENV = 'production';\n\t\tconst config = await get_config();\n\n\t\tconst { start } = await import('./api/start');\n\n\t\ttry {\n\t\t\tawait start({ port, config });\n\n\t\t\tconsole.log(colors.bold().cyan(`> Listening on http://localhost:${port}`));\n\t\t\tif (open) if (open) launch(port);\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog\n\t.command('adapt')\n\t.describe('Customise your production build for different platforms')\n\t.option('--verbose', 'Log more stuff', false)\n\t.action(async ({ verbose }) => {\n\t\tprocess.env.NODE_ENV = 'production';\n\t\tconst config = await get_config();\n\n\t\tconst { adapt } = await import('./api/adapt');\n\n\t\ttry {\n\t\t\tawait adapt(config, { verbose });\n\t\t} catch (error) {\n\t\t\thandle_error(error);\n\t\t}\n\t});\n\nprog.parse(process.argv, { unknown: (arg) => `Unknown option: ${arg}` });\n"],"names":["colors","pkg.version"],"mappings":"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"}